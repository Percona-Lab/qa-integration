scope: patroni_cls
namespace: /var/lib/pgsql/config/
name: pg_node_{{ item }}

restapi:
    listen: 0.0.0.0:8008
    connect_address: "pdpgsql_pmm_patroni_{{ pg_version }}_{{ item }}:8008"
etcd3:
    host: "pdpgsql_pmm_patroni_{{ pg_version }}_1:2379"
    host: "pdpgsql_pmm_patroni_{{ pg_version }}_2:2379"
    host: "pdpgsql_pmm_patroni_{{ pg_version }}_3:2379"
bootstrap:
  dcs:
    ttl: 30
    loop_wait: 10
    retry_timeout: 10
    maximum_lag_on_failover: 1048576
    postgresql:
      use_pg_rewind: true
      use_slots: true
      parameters:
initdb:
  - encoding: UTF8
  - data-checksums
  - waldir: /pg_wal
  - wal-segsize=512
pg_hba:
  - host replication replicator 127.0.0.1/32 md5
  - host replication replicator 172.18.0.0/16 md5
  - host all all 0.0.0.0/0 md5
users:
  admin:
    password: admin
    options:
      - createrole
      - createdb
postgresql:
  listen: 0.0.0.0:5432
  connect_address: "pdpgsql_pmm_patroni_{{ pg_version }}_{{ item }}:5432"
  data_dir: /var/lib/pgsql/{{ pg_version}}/data
  bin_dir: /usr/pgsql-{{ pg_version }}/bin
  pgpass: /tmp/pgpass
  authentication:
    replication:
       username: replicator
       password: replPasswd
    superuser:
      username: postgres
      password: pg1234
  create_replica_methods:
    - pgbackrest
    - basebackup
  pgbackrest:
   command: pgbackrest --stanza=patroni_backup restore --type=none
   keep_data: True
   no_params: True
  basebackup:
    checkpoint: 'fast'
tags:
  nofailover: false
  noloadbalance: false
  clonefrom: false
  nosync: false