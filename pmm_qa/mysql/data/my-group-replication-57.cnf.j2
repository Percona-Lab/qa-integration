[mysqld]
# General server configuration
server_id={{ server_id_start + item - 1 }}
binlog_format=ROW
bind-address=0.0.0.0
port={{ mysql_listen_port }}
userstat=1

# 5.7 General replication settings
gtid_mode=ON
enforce_gtid_consistency=ON
master_info_repository=TABLE
relay_log_info_repository=TABLE
transaction_write_set_extraction=XXHASH64
binlog_checksum=NONE
log_bin=binlog
log_slave_updates=ON
# NO: disabled_storage_engines in 5.7
lower_case_table_names=2

# Report host for replication/monitoring
report_host={{ container_prefix }}{{ item }}

# Group Replication Settings
# (Available in MySQL 5.7.17+ and must be installed as plugin)
plugin_load_add='group_replication.so'
loose-group_replication_group_name='aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee'
loose-group_replication_local_address='{{ container_prefix }}{{ item }}:{{ group_seeds_port }}'
loose-group_replication_group_seeds={% for i in range(1, nodes_count | int + 1) %}{{ container_prefix }}{{ i }}:{{ group_seeds_port }}{% if not loop.last %},{% endif %}{% endfor %}
loose-group_replication_communication_stack=XCOM

# Group replication behavior
loose-group_replication_start_on_boot=OFF
loose-group_replication_bootstrap_group=OFF
loose-group_replication_single_primary_mode=ON
loose-group_replication_enforce_update_everywhere_checks=OFF

# Recovery settings
loose-group_replication_recovery_retry_count=10
loose-group_replication_recovery_reconnect_interval=60

# Crash-safe replication settings
relay-log={{ container_prefix }}{{ item }}-relay-bin
relay_log_recovery=ON
relay_log_purge=ON

# Performance and connection settings
max_connections=1000
innodb_buffer_pool_size=256M
